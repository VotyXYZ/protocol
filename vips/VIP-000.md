# VIP-000: Basic concepts

This VIP defines the basic concepts.

## DID

DID is the primitive voting and proposing unit.

> DID stand for Decentralized Identity

Software `MAY` choose what kinds of DID systems they want to support.

All supported DID systems are registered in [VIP-001](/vips/VIP-001.md).

## Document

There are 3 types of document in JSON format:

- **Community**: a hub for all related proposals.

  ```ts
  type Community = {
    name: string;
    groups: {
      name: string;
      timing: {
        publicity: number; // voting start delay
        voting: number; // voting period duration
      };
    }[];
  };
  ```

- **Proposal**: describes the issue of a vote.

  ```ts
  type Proposal = {
    community: string; // belongs to which community
    group: number; // index of community's group
    title: string;
    promise: string; // the effect of the proposal
    options: string[]; // voting options, must be unique
    snapshots: { [coin_type: string]: string }; // records of blockchains' height
  };
  ```

- **Vote**: voter's decision.

  ```ts
  type Vote = {
    proposal: string; // belongs to which proposal
    choice: string; // choice of voter
  };
  ```

All of the documents `MUST` be stored in a storage.

Software `MAY` choose what kinds of storage providers they want to support.

All supported storage providers are registered in [VIP-002](/vips/VIP-002.md).

## Signature

Voty Protocol uses cryptographic signature to verify the authorship of document.

Every type of document contains a field called `author`:

```ts
type Author = {
  did: string; // DID name
  coin_type: number; // SLIP-0044 coin_type of a blockchain
  snapshot: string; // block_height of blockchain
  address: string; // resolved blockchain wallet address
  signature: string; // base64 string of signature
};

type WithAuthor<T extends object> = T & { author: Author };
```

A DID `MUST` be resolved to a certain wallet address with given coin_type and block_height. Then we can use the resolved wallet to sign and verify signature.

```
     coin_type + block_height
DID -------- resolve --------> wallet address
```

Here is a piece of pseudo code shows how signature is calculated:

```ts
function sign_document(document: Community | Proposal | Vote) {
  const hash = binary_to_hex(sha_256(json_stringify(document)));
  const message = `You are signing for Voty Protocol.\n\nhash: 0x${hash}`;
  return binary_to_base64(wallet_sign(message));
}
```

Here is another piece of pseudo code shows how to verify author:

```ts
function verify_author(message: string, author: Author) {
  const resolved_address = resolve_did(
    author.did,
    author.coin_type,
    author.snapshot
  );
  return (
    resolved_address === author.address &&
    resolved_address ===
      recover_address(message, base64_to_binary(author.signature))
  );
}
```
